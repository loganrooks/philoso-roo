# Hegel Philosophy RooCode Suite - V13 Requirements Specification

**Date:** 2025-05-02
**Version:** 1.0
**Status:** Draft
**Based On:** `docs/architecture/architecture_v13.md`

**Goal:** This document provides detailed functional requirements and specifications for the V13 architecture of the Hegel Philosophy RooCode Suite. It translates the design outlined in `docs/architecture/architecture_v13.md` into actionable specifications for implementation.

## 1. Overview

V13 introduces significant enhancements focused on knowledge management and system reflexivity:

*   **Philosophy Knowledge Base (KB):** A dedicated repository (`philosophy-knowledge-base/`) for structured philosophical domain knowledge, managed by `philosophy-kb-manager`.
*   **Philosophical Inquiry Workflow:** A structured process for generating, refining, and storing philosophical questions and theses within the KB.
*   **System Self-Reflection Workflow:** A mechanism for the system to analyze its own operations, methods, and architecture, facilitated by the new `philosophy-meta-reflector` mode.
*   **Mode Refinements:** Updates to existing modes to interact with the KB via `philosophy-kb-manager` and participate in the new workflows. Clear separation between KB (`kb-manager`) and SPARC Memory Bank (`evidence-manager`).

## 2. Philosophy Knowledge Base (KB) Specifications

### 2.1. Purpose & Location

*   **Purpose:** To serve as a centralized, structured, and persistent repository for philosophical domain knowledge, separate from SPARC's operational memory.
*   **Location:** A new top-level directory: `philosophy-knowledge-base/`.

### 2.2. Management

*   The KB MUST be accessed and modified **exclusively** through the `philosophy-kb-manager` mode. No other mode should directly read from or write to the `philosophy-knowledge-base/` directory.

### 2.3. Structure

*   The KB SHALL be organized into subdirectories based on content type:
    *   `philosophy-knowledge-base/concepts/`
    *   `philosophy-knowledge-base/arguments/`
    *   `philosophy-knowledge-base/quotations/`
    *   `philosophy-knowledge-base/references/`
    *   `philosophy-knowledge-base/questions/`
    *   `philosophy-knowledge-base/theses/`
    *   `philosophy-knowledge-base/relationships/`
    *   `philosophy-knowledge-base/methods/`
    *   `philosophy-knowledge-base/meta-reflections/`
    *   `philosophy-knowledge-base/indices/`

### 2.4. Content Types & Entry Format

*   Each entry in the KB SHALL be a separate Markdown file.
*   Each entry MUST contain a YAML frontmatter block and Markdown content.
*   **YAML Frontmatter Fields (Mandatory):**
    *   `id`: Unique identifier (e.g., UUID) for the entry. MUST be generated by `kb-manager` upon creation.
    *   `type`: Specifies the content type (e.g., `Concept`, `Argument`, `Quotation`, `Reference`, `Question`, `Thesis`, `Relationship`, `Method`, `Meta-Reflection`, `Index`). MUST match the subdirectory.
    *   `timestamp`: ISO 8601 timestamp (YYYY-MM-DD HH:MM:SS) of creation/last modification.
    *   `generating_mode`: The slug of the mode that originated the data (e.g., `philosophy-pre-lecture`, `philosophy-meta-reflector`).
*   **YAML Frontmatter Fields (Optional/Contextual):**
    *   `source_ref_keys`: List of keys linking to entries in `philosophy-knowledge-base/references/`. Used to associate KB content with its source material.
    *   `extraction_markers`: List of specific markers (e.g., unique IDs, text snippets) linking to precise locations within processed source text files (e.g., in `source_materials/processed/`).
    *   `related_ids`: List of `id`s of other KB entries, establishing explicit links.
    *   `tags`: List of relevant keywords for categorization and querying (e.g., `meta`, `inquiry`, `hegel`, `critique`, `logic`, `ethics`). `Question` types MUST be tagged as either `inquiry` or `meta`.
    *   *Type-Specific Fields:* Additional fields relevant to the `type` (e.g., `definition` for Concept, `premises`/`conclusion` for Argument, `question_text` for Question, `thesis_statement` for Thesis, `index_path`/`chunk_summary` for Index).
*   **Markdown Content:** The main body of the entry, containing detailed descriptions, analysis, text excerpts, etc.

### 2.5. Interaction Methods (via `kb-manager`)

*   **Create:** Add new entries to the KB. `kb-manager` assigns `id` and `timestamp`.
*   **Read/Query:** Retrieve entries based on `id`, `type`, `tags`, `related_ids`, keywords within content, or other metadata. `kb-manager` SHALL provide flexible query capabilities.
*   **Update:** Modify existing entries. `kb-manager` MUST update the `timestamp`.
*   **Delete:** Remove entries (use with caution; consider archival instead).
*   **Link:** Create or update `related_ids` between entries.

### 2.6. Self-Modification

*   Modes MAY propose modifications to KB content or structure (e.g., adding relationships, refining definitions).
*   Proposals MUST be sent to `philosophy-orchestrator`.
*   `philosophy-orchestrator` MUST route the proposal to the User for approval.
*   Upon User approval, `philosophy-orchestrator` MUST instruct `philosophy-kb-manager` to execute the modification.
*   `philosophy-kb-manager` MUST log the modification (e.g., within the entry or a dedicated log).

## 3. Philosophical Inquiry Workflow Specifications

### 3.1. Purpose

*   To provide a structured workflow for generating, refining, storing, and utilizing philosophical questions and theses within the KB, primarily supporting research and essay writing.

### 3.2. Steps & Mode Responsibilities

1.  **Input/Trigger:**
    *   User explicitly prompts for inquiry on a topic/text.
    *   Analysis modes (`pre-lecture`, `class-analysis`, `secondary-lit`, `dialectical-analysis`) identify potential questions or novel concepts during their analysis.
2.  **Proto-Storage (`kb-manager`):**
    *   Analysis modes send identified proto-questions or concepts (with context and source links) to `kb-manager`.
    *   `kb-manager` stores these as `Question` or `Concept` entries, tagged appropriately (e.g., `proto-question`, `hegel`).
3.  **Refinement (`philosophy-questioning`):**
    *   Triggered by `orchestrator` based on user request or availability of proto-questions.
    *   `philosophy-questioning` queries `kb-manager` for relevant proto-questions and related concepts/arguments.
    *   It analyzes the questions for clarity, scope, relevance, and philosophical interest, potentially refining wording or breaking down complex questions.
4.  **Refined Storage (`kb-manager`):**
    *   `philosophy-questioning` sends the refined questions (linked to original proto-questions if applicable) back to `kb-manager`.
    *   `kb-manager` updates existing entries or creates new `Question` entries, tagged as `inquiry` (distinct from `meta`).
5.  **Thesis Development (`philosophy-essay-prep`):**
    *   Triggered by `orchestrator` when an essay task begins.
    *   `philosophy-essay-prep` queries `kb-manager` for relevant refined `Question` entries and supporting `Concept`, `Argument`, `Quotation` entries based on the essay prompt.
    *   It develops a specific, arguable thesis statement addressing a chosen question.
6.  **Thesis Storage (`kb-manager`):**
    *   `philosophy-essay-prep` sends the developed thesis statement to `kb-manager`.
    *   `kb-manager` stores it as a `Thesis` entry, linking it back to the corresponding `Question` entry (`related_ids`).
7.  **Essay Cycle:**
    *   The standard essay generation workflow proceeds, orchestrated by `essay-prep`.
    *   Modes (`draft-generator`, `citation-manager`, `verification-agent`) query `kb-manager` (via `essay-prep` or directly as needed) for the thesis, relevant questions, concepts, arguments, quotations, and references to support drafting, citation, and verification.

### 3.3. Data Flow

*   Proto-questions/concepts -> `kb-manager`
*   Refined questions -> `kb-manager`
*   Thesis statements -> `kb-manager`
*   KB queries (for concepts, arguments, quotes, refs) -> `kb-manager`
*   KB data packages -> Requesting modes

## 4. System Self-Reflection Workflow Specifications

### 4.1. Purpose

*   To enable the system to perform meta-level analysis on its own architecture, methods, assumptions, and outputs, identifying potential limitations, biases, or areas for improvement.

### 4.2. Steps & Mode Responsibilities

1.  **Trigger:**
    *   User explicitly requests system reflection (e.g., "Critique the V13 architecture", "Analyze potential biases in the dialectical analysis mode").
    *   `philosophy-orchestrator` detects anomalies (e.g., repeated failures from a specific mode, contradictions flagged by `verification-agent` across multiple runs).
    *   A pre-defined schedule (e.g., periodic review).
2.  **Activation (`orchestrator` -> `meta-reflector`):**
    *   `philosophy-orchestrator` identifies the trigger and delegates the reflection task to `philosophy-meta-reflector`, providing context (e.g., specific area of concern, relevant logs).
3.  **Analysis (`meta-reflector`):**
    *   `meta-reflector` queries `philosophy-evidence-manager` for relevant SPARC Memory Bank data (active context, global context, feedback logs, decision logs).
    *   `meta-reflector` reads relevant system documentation (`docs/architecture/`, `docs/specs/`), mode rules (`.roo/rules-*/`), and potentially configuration files.
    *   `meta-reflector` queries `philosophy-kb-manager` for existing `Meta-Reflection` entries, `Method` descriptions, or relevant philosophical concepts (e.g., concepts related to bias, interpretation).
    *   Analysis guided by principles in `architecture-questioning.md`.
4.  **Reflection Generation (`meta-reflector`):**
    *   Based on its analysis, `meta-reflector` generates:
        *   **Meta-Reflections:** Observations about system behavior, limitations, assumptions, potential biases, architectural strengths/weaknesses.
        *   **Meta-Questions:** Questions directed at the system's own structure or process (e.g., "Does the current KB structure adequately capture relational nuances?", "How does the reliance on script X impact text processing outcomes?").
5.  **Storage (`kb-manager`):**
    *   `meta-reflector` sends generated reflections and questions to `philosophy-kb-manager`.
    *   `kb-manager` stores them as `Meta-Reflection` or `Question` entries (tagged as `meta`).
6.  **Proposal Generation (`meta-reflector`, Optional):**
    *   If the reflection identifies actionable improvements, `meta-reflector` formulates specific proposals:
        *   **KB Change:** Proposal to modify KB content or structure (e.g., add a new relationship type, refine a method description).
        *   **Architectural Change:** Proposal to modify mode interactions, responsibilities, or add/remove modes.
        *   **Methodological Change:** Proposal to alter a workflow, change a tool used, or explore alternative configurations (potentially via Git branching).
7.  **Proposal Routing (`orchestrator`):**
    *   `meta-reflector` sends any generated proposals to `philosophy-orchestrator`.
    *   `philosophy-orchestrator` MUST route the proposal to the User for review and approval.
8.  **Approval Handling (`orchestrator` -> `kb-manager`/`architect`/`devops`):**
    *   If the User approves a proposal:
        *   KB Change: `orchestrator` instructs `kb-manager` to execute the change.
        *   Architectural Change: `orchestrator` delegates implementation to `architect` (and potentially `code`).
        *   Methodological Change: `orchestrator` instructs `kb-manager` (for method description updates) and/or delegates to `devops`/`architect` (for branching/tooling changes).
9.  **Reporting (`meta-reflector` -> `orchestrator` -> User):**
    *   `meta-reflector` provides a summary of its findings, stored reflections/questions, and any proposals made back to `philosophy-orchestrator`.
    *   `philosophy-orchestrator` relays this report to the User.

### 4.3. Data Flow

*   SPARC MB data -> `meta-reflector` (via `evidence-manager`)
*   Docs/Rules/Config -> `meta-reflector` (via file reads)
*   KB data (meta-reflections, methods) -> `meta-reflector` (via `kb-manager`)
*   Generated reflections/meta-questions -> `kb-manager`
*   Proposals -> `orchestrator` -> User -> `orchestrator` -> `kb-manager`/`architect`/`devops`
*   Summary Report -> `orchestrator` -> User

## 5. `philosophy-kb-manager` Mode Specifications

### 5.1. Identity & Purpose

*   **Name:** Philosophy KB Manager
*   **Slug:** `philosophy-kb-manager`
*   **Purpose:** To act as the **sole and exclusive interface** for all interactions with the Philosophy Knowledge Base (`philosophy-knowledge-base/`). Ensures data integrity, manages structure, and handles all CRUD and query operations for philosophical domain knowledge.

### 5.2. Functional Requirements

*   **Exclusive Access:** MUST be the only mode directly interacting with files within `philosophy-knowledge-base/`.
*   **CRUD Operations:**
    *   MUST support creating new KB entries (assigning `id`, `timestamp`, validating `type`).
    *   MUST support reading/retrieving one or more KB entries based on specified criteria.
    *   MUST support updating existing KB entries (updating `timestamp`).
    *   MUST support deleting KB entries (or implement an archival mechanism).
*   **Querying:**
    *   MUST support querying entries by `id`, `type`, `tags`.
    *   MUST support querying entries based on `related_ids`.
    *   MUST support keyword searching within the Markdown content of entries.
    *   MUST support querying based on other YAML metadata (e.g., `generating_mode`, date ranges).
    *   Query results SHOULD be returned in a structured format (e.g., list of file contents, JSON summary).
*   **Linking:**
    *   MUST manage the `related_ids` field to establish and maintain explicit links between KB entries.
    *   MUST ensure `id`s used in `related_ids` are valid.
*   **Data Integrity:**
    *   MUST validate the structure of incoming data against the expected format (YAML frontmatter + Markdown).
    *   MUST ensure mandatory YAML fields (`id`, `type`, `timestamp`, `generating_mode`) are present and correctly formatted.
    *   MUST ensure `type` matches the subdirectory where the entry is stored.
*   **Structure Management:**
    *   MUST create entries in the correct subdirectory based on their `type`.
    *   MAY implement mechanisms for suggesting or enforcing consistent tagging.
*   **Modification Execution:**
    *   MUST accept instructions from `philosophy-orchestrator` (following User approval) to execute specific modifications to KB entries or structure.
    *   MUST log executed modifications appropriately.
*   **Error Handling:** MUST report errors clearly if operations fail (e.g., file access issues, validation errors, invalid queries).

### 5.3. Interfaces

*   **Input:**
    *   Structured requests from other modes specifying the operation (Create, Read, Update, Delete, Link) and associated data/query parameters.
    *   Modification instructions from `philosophy-orchestrator`.
*   **Output:**
    *   Structured data packages containing the results of Read/Query operations.
    *   Confirmation messages for successful Create, Update, Delete, Link, Modification operations.
    *   Error messages upon failure.

### 5.4. Dependencies

*   `philosophy-knowledge-base/` directory structure and files.
*   `philosophy-orchestrator` (for receiving modification instructions).
*   All modes requiring access to philosophical domain knowledge.

## 6. `philosophy-meta-reflector` Mode Specifications

### 6.1. Identity & Purpose

*   **Name:** Philosophy Meta-Reflector
*   **Slug:** `philosophy-meta-reflector`
*   **Purpose:** To perform meta-level analysis of the Hegel Philosophy RooCode Suite itself, questioning its assumptions, methods, architecture, and outputs to identify areas for improvement and foster reflexivity.

### 6.2. Functional Requirements

*   **Triggering:** MUST activate upon receiving a delegation request from `philosophy-orchestrator` (triggered by User, anomaly detection, or schedule).
*   **Analysis Targets:**
    *   MUST be able to query and analyze SPARC Memory Bank data via `philosophy-evidence-manager` (e.g., `activeContext.md`, `globalContext.md`, feedback logs).
    *   MUST be able to read and analyze system documentation (`docs/architecture/`, `docs/specs/`).
    *   MUST be able to read and analyze mode rules (`.roo/rules-*/`).
    *   MUST be able to query and analyze existing KB entries via `philosophy-kb-manager` (especially `Meta-Reflection`, `Method`, `Question` types).
    *   MAY be able to read workspace code (requires careful scoping and security considerations).
*   **Reflection Generation:**
    *   MUST generate textual reflections on the system's state, behavior, assumptions, limitations, biases, etc., based on its analysis.
    *   MUST generate specific meta-questions directed at the system's structure or processes.
    *   Analysis and reflection SHOULD be guided by principles outlined in `architecture-questioning.md`.
*   **Storage:**
    *   MUST store generated reflections as `Meta-Reflection` entries in the KB via `philosophy-kb-manager`.
    *   MUST store generated meta-questions as `Question` entries (tagged `meta`) in the KB via `philosophy-kb-manager`.
*   **Proposal Generation:**
    *   MAY generate specific, actionable proposals for improvement based on reflections.
    *   Proposals MUST clearly state the issue, the proposed change, and the rationale.
    *   Proposals MUST be categorized (KB Change, Architectural Change, Methodological Change).
*   **Proposal Routing:**
    *   MUST send all generated proposals to `philosophy-orchestrator` for routing to the User.
*   **Reporting:**
    *   MUST provide a summary report of its findings, stored reflections/questions, and any proposals made back to `philosophy-orchestrator`.

### 6.3. Interfaces

*   **Input:**
    *   Delegation request from `philosophy-orchestrator` (including trigger context).
    *   Data from `philosophy-evidence-manager` (SPARC MB content).
    *   Data from `philosophy-kb-manager` (KB content).
    *   Content from `docs/`, `.roo/` files.
*   **Output:**
    *   Data storage requests (reflections, meta-questions) to `philosophy-kb-manager`.
    *   Proposal messages to `philosophy-orchestrator`.
    *   Summary report to `philosophy-orchestrator`.

### 6.4. Dependencies

*   `philosophy-orchestrator` (for triggering and proposal routing).
*   `philosophy-kb-manager` (for storing/retrieving reflections, methods, meta-questions).
*   `philosophy-evidence-manager` (for accessing SPARC MB).
*   Access to `docs/` and `.roo/` directories.
*   `architecture-questioning.md` (for guiding principles).

## 7. Updates to Existing Modes

### 7.1. `philosophy-evidence-manager` (Revised Scope)

*   **Data Access:** MUST ONLY interact with `memory-bank/` and potentially `analysis_workspace/`. MUST NOT interact with `philosophy-knowledge-base/`.
*   **Functionality:** Role is limited to providing SPARC operational context (logs, decisions, feedback) to other modes.

### 7.2. `philosophy-text-processor`

*   **KB Interaction:** MUST send extracted index/chunk structure information and citation data to `philosophy-kb-manager` for storage in `philosophy-knowledge-base/indices/` and `philosophy-knowledge-base/references/` respectively. (Changed from `evidence-manager`).

### 7.3. Analysis Modes (`pre-lecture`, `class-analysis`, `secondary-lit`, `dialectical-analysis`)

*   **KB Querying:** MUST query `philosophy-kb-manager` (instead of `evidence-manager`) to retrieve processed text chunks/indices, existing concepts, arguments, questions, etc., relevant to their analysis task.
*   **KB Storage:** MUST send their findings (new concepts, arguments, analyses, proto-questions) to `philosophy-kb-manager` for storage in the appropriate KB subdirectory.
*   **SPARC Context:** MAY still query `philosophy-evidence-manager` if they require SPARC operational context (e.g., previous run logs).

### 7.4. `philosophy-questioning`

*   **KB Querying:** MUST query `philosophy-kb-manager` for proto-questions, concepts, and arguments to facilitate refinement.
*   **KB Storage:** MUST send refined philosophical questions (tagged `inquiry`) to `philosophy-kb-manager`.

### 7.5. `philosophy-essay-prep`

*   **KB Querying:** MUST query `philosophy-kb-manager` for refined questions, theses, concepts, arguments, quotations, and references needed for outlining and evidence gathering.
*   **KB Storage:** MUST send the developed thesis statement to `philosophy-kb-manager` for storage as a `Thesis` entry, linked to the relevant `Question`.
*   **Coordination:** Continues to coordinate `draft-generator`, `citation-manager`, `verification-agent`, ensuring they receive necessary data (potentially retrieved from `kb-manager` by `essay-prep` itself or by directing the modes to query `kb-manager`).
*   **Version Control:** Retains responsibility for Git operations on `essay_prep/`.

### 7.6. `philosophy-draft-generator`

*   **KB Querying:** MUST request necessary evidence (thesis, concepts, arguments, quotes) from `philosophy-kb-manager` (likely via `essay-prep`).

### 7.7. `philosophy-citation-manager`

*   **KB Querying:** MUST request reference details and specific citation location data (potentially linked via extraction markers) from `philosophy-kb-manager`.

### 7.8. `philosophy-verification-agent`

*   **KB Querying:** MUST request evidence, references, and potentially processed source chunk paths/indices from `philosophy-kb-manager` to perform verification against the KB and source material.

### 7.9. `philosophy-orchestrator`

*   **Workflow Management:** MUST implement and manage the new `philosophical_inquiry` and `system_self_reflection` workflows, including triggering and delegating to the correct modes (`questioning`, `meta-reflector`, `kb-manager`, etc.).
*   **Proposal Routing:** MUST handle proposals received from `meta-reflector` (and potentially other modes). MUST route these proposals to the User for approval.
*   **Approval Handling:** MUST relay User approval for KB modifications to `kb-manager`. MUST relay User approval for architectural/methodological changes to `architect` or `devops` as appropriate.
*   **Mode Interaction:** MUST update its delegation logic to reflect the revised roles of `evidence-manager` and the introduction of `kb-manager` and `meta-reflector`.

## 8. Version Control Specifications (V13)

*   **Essay Versioning:** `philosophy-essay-prep` MUST continue to manage Git version control (commits, branching if necessary) for files within the `essay_prep/` directory.
*   **KB Versioning (Consideration):** Implementation MAY include Git versioning for the `philosophy-knowledge-base/` directory. If implemented, `philosophy-kb-manager` or `devops` would manage commits, likely triggered by approved modifications via the `orchestrator`. This requires further specification if pursued.
*   **System Evolution Branching (Consideration):** Proposals from `meta-reflector` for significant system changes MAY trigger the creation of separate Git branches by `devops`/`architect` (coordinated by `orchestrator`) to allow exploration without affecting the main branch. This requires further specification if pursued.

## 9. Configuration Specifications (V13)

*   The `.roo/.roomodes` file MUST be updated to include entries for the new modes: `philosophy-kb-manager` and `philosophy-meta-reflector`, pointing to their respective `.clinerules` files within the `.roo/rules-*/` structure.
*   New `.clinerules` files MUST be created for `philosophy-kb-manager` and `philosophy-meta-reflector` in their respective `.roo/rules-*/` directories, defining their identity, description, and core logic according to these specifications.
*   Existing `.clinerules` files for all updated modes (Section 7) MUST be revised to reflect changes in dependencies, interactions (especially querying `kb-manager` vs. `evidence-manager`), and participation in new workflows.